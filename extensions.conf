;### ARCHIVO DE CONFIGURACION DE DIAL PLAN DEFINITIVO PARA EL INCEPTIA VOICE ENGINE ###

;###########################################
;### VARIABLES GLOBALES DE CONFIGURACION ###
;###########################################
[globals]
RingTimeOut=30

;########################
;### DIALPLAN GENERAL ###
;########################
[from-proxy]
;### RUTA EXCLUSIVA PARA CELULARES ###
exten => _+998877549X., 1, Verbose(Nueva llamada entrante hacia ${EXTEN} - Ruta celulares ${PJSIP_HEADER(read,X-AMD-Enabled)})
	same => n,GoSub(SetMobileArg,${EXTEN:6},1)
    same => n,GoToIf($["${PJSIP_HEADER(read,X-AMD-Enabled)}"!= ""]?setAMD:directCall)
    same => n(setAMD),Set(AMDSub=U(checkAMD,s,1))
    same => n,Verbose(Acabo de cargar la variable para el GoSubDial = ${AMDSub})
    same => n(directCall),Dial(PJSIP/${Destination}@SBC,${RingTimeOut},${AMDSub})
    same => n,Hangup()

exten => _+99X., 1, Verbose(Nueva llamada entrante hacia ${EXTEN} - Ruta normal ${PJSIP_HEADER(read,X-AMD-Enabled)})
    same => n,GoToIf($["${PJSIP_HEADER(read,X-AMD-Enabled)}"!= ""]?setAMD:directCall)
    same => n(setAMD),Set(AMDSub=U(checkAMD,s,1))
    same => n,Verbose(Acabo de cargar la variable para el GoSubDial = ${AMDSub})
    same => n(directCall),Dial(PJSIP/${EXTEN:1}@SBC,${RingTimeOut},${AMDSub})
    same => n,Hangup()


;#################
;### FUNCIONES ###
;#################
[checkAMD]
exten => s,1,NoOp(Entramos al AMD Sub)
	same => n,AMD
	same => n,NoOP(El resultado del AMD es ${AMDSTATUS})
	same => n,GotoIf($["${AMDSTATUS}" = "HUMAN"]?humano:noHumano)
	same => n(humano),NoOp(Es humano asi que no hago nada)
	same => n,Return()
	same => n(noHumano),NoOp(Esto fue una maquina asi que marcamos HangupCause 97)
	same => n,Hangup(97)

[SetMobileArg]
exten => _22[013]XXXXXXX, 1, Verbose(Entramos a la App de celulares)
	same => n,Set(AreaCode=${EXTEN:0:-7})
    same => n,Set(Number=${EXTEN:3})
    same => n,Set(Destination=${AreaCode}15${Number})
    same => n,Return(${Destination})

exten => _23[067]XXXXXXX, 1, Verbose(Entramos a la App de celulares)
	same => n,Set(AreaCode=${EXTEN:0:-7})
    same => n,Set(Number=${EXTEN:3})
    same => n,Set(Destination=${AreaCode}15${Number})
    same => n,Return(${Destination})
    
exten => _249XXXXXXX, 1, Verbose(Entramos a la App de celulares)
	same => n,Set(AreaCode=${EXTEN:0:-7})
    same => n,Set(Number=${EXTEN:3})
    same => n,Set(Destination=${AreaCode}15${Number})
    same => n,Return(${Destination})

exten => _26[01346]XXXXXXX, 1, Verbose(Entramos a la App de celulares)
	same => n,Set(AreaCode=${EXTEN:0:-7})
    same => n,Set(Number=${EXTEN:3})
    same => n,Set(Destination=${AreaCode}15${Number})
    same => n,Return(${Destination})

exten => _280XXXXXXX, 1, Verbose(Entramos a la App de celulares)
	same => n,Set(AreaCode=${EXTEN:0:-7})
    same => n,Set(Number=${EXTEN:3})
    same => n,Set(Destination=${AreaCode}15${Number})
    same => n,Return(${Destination})

exten => _29[14789]XXXXXXX, 1, Verbose(Entramos a la App de celulares)
	same => n,Set(AreaCode=${EXTEN:0:-7})
    same => n,Set(Number=${EXTEN:3})
    same => n,Set(Destination=${AreaCode}15${Number})
    same => n,Return(${Destination})

exten => _336XXXXXXX, 1, Verbose(Entramos a la App de celulares)
	same => n,Set(AreaCode=${EXTEN:0:-7})
    same => n,Set(Number=${EXTEN:3})
    same => n,Set(Destination=${AreaCode}15${Number})
    same => n,Return(${Destination})

exten => _34[12358]XXXXXXX, 1, Verbose(Entramos a la App de celulares)
	same => n,Set(AreaCode=${EXTEN:0:-7})
    same => n,Set(Number=${EXTEN:3})
    same => n,Set(Destination=${AreaCode}15${Number})
    same => n,Return(${Destination})

exten => _35[138]XXXXXXX, 1, Verbose(Entramos a la App de celulares)
	same => n,Set(AreaCode=${EXTEN:0:-7})
    same => n,Set(Number=${EXTEN:3})
    same => n,Set(Destination=${AreaCode}15${Number})
    same => n,Return(${Destination})

exten => _36[24]XXXXXXX, 1, Verbose(Entramos a la App de celulares)
	same => n,Set(AreaCode=${EXTEN:0:-7})
    same => n,Set(Number=${EXTEN:3})
    same => n,Set(Destination=${AreaCode}15${Number})
    same => n,Return(${Destination})

exten => _37[069]XXXXXXX, 1, Verbose(Entramos a la App de celulares)
	same => n,Set(AreaCode=${EXTEN:0:-7})
    same => n,Set(Number=${EXTEN:3})
    same => n,Set(Destination=${AreaCode}15${Number})
    same => n,Return(${Destination})

exten => _38[013578]XXXXXXX, 1, Verbose(Entramos a la App de celulares)
	same => n,Set(AreaCode=${EXTEN:0:-7})
    same => n,Set(Number=${EXTEN:3})
    same => n,Set(Destination=${AreaCode}15${Number})
    same => n,Return(${Destination})

exten => _[23]XXXXXXXXX, 1, Verbose(Entramos a la App de celulares)
	same => n,Set(AreaCode=${EXTEN:0:-6})
    same => n,Set(Number=${EXTEN:4})
    same => n,Set(Destination=${AreaCode}15${Number})
    same => n,Return(${Destination})

exten => _11XXXXXXXX, 1, Verbose(Entramos a la App de celulares)
	same => n,Set(AreaCode=${EXTEN:0:-8})
    same => n,Set(Number=${EXTEN:2})
    same => n,Set(Destination=${AreaCode}15${Number})
    same => n,Return(${Destination})